#!/bin/bash

#WPP folder
FOLDER=~/dotfiles/wallpaper/
VFOLDER=~/dotfiles/livewallpaper/
CURRENTIMAGE=~/dotfiles/cache/currentimg.txt
THUMBCACHE=~/dotfiles/cache/thumbcache.jpg
export PATH=$PATH:~/.cargo/bin

if [ $# -eq 0 ]; then
	wallset --quit
        #SELECTED IMAGE:
        SECIMG=$(nsxiv -a -q -t -r -o $FOLDER | xargs readlink -f)
else
        if [[ $1 == "v" ]]; then
                cd $VFOLDER
                SECIMG=$(zenity --file-selection --title="Escolha um vÃ­deo" --filename=$VFOLDER)
        else
                SECIMG=$1
        fi
fi


#wal -i $SECIMG --backend haishoku #--saturate 0.5	


pkill xwinwrap

echo $SECIMG > $CURRENTIMAGE

if [[ $SECIMG == *.mp4  ||  $SECIMG == *.webm ]]; then
        ffmpeg -y -i $SECIMG -vf "select=eq(n\,0)" -q:v 2 $THUMBCACHE
        wallust $THUMBCACHE
        xrdb ~/.Xresources
        awesome-client "awesome.restart()"
        exit
fi

#in case it is an image
wallust $SECIMG 
xrdb ~/.Xresources
awesome-client "awesome.restart()"